!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.hulk=e():t.hulk=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=26)}([function(t,e,r){var n,i,o;o=function(){function t(t){var e=[];if(0===t.length)return"";if("string"!=typeof t[0])throw new TypeError("Url must be a string. Received "+t[0]);if(t[0].match(/^[^/:]+:\/*$/)&&t.length>1){var r=t.shift();t[0]=r+t[0]}t[0].match(/^file:\/\/\//)?t[0]=t[0].replace(/^([^/:]+):\/*/,"$1:///"):t[0]=t[0].replace(/^([^/:]+):\/*/,"$1://");for(var n=0;n<t.length;n++){var i=t[n];if("string"!=typeof i)throw new TypeError("Url must be a string. Received "+i);""!==i&&(n>0&&(i=i.replace(/^[\/]+/,"")),i=n<t.length-1?i.replace(/[\/]+$/,""):i.replace(/[\/]+$/,"/"),e.push(i))}var o=e.join("/"),a=(o=o.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return o=a.shift()+(a.length>0?"?":"")+a.join("&")}return function(){return t("object"==typeof arguments[0]?arguments[0]:[].slice.call(arguments))}},t.exports?t.exports=o():void 0===(i="function"==typeof(n=o)?n.call(e,r,e,t):n)||(t.exports=i)},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},a=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.fRetry=e.FetchError=void 0;var c=u(r(13)),l=u(r(17)),f=r(5),p=function(t){function e(r,n,i,o,a){var s=t.call(this,r)||this;return Object.setPrototypeOf?Object.setPrototypeOf(s,e.prototype):s.__proto__=e.prototype,s.url=n,s.method=i,s.requestBody=o,s.responseStatus=a,s}return i(e,t),e}(Error);e.FetchError=p;e.fRetry=function(t){return function(e,r,n,i){return void 0===n&&(n=!0),a(void 0,void 0,void 0,(function(){var u,d;return s(this,(function(h){return u=(0,l.default)(f.trackClientErrors,500),d=function(t){return a(void 0,void 0,void 0,(function(){var a,c,l,f,d,h,v,y,b,m,g,_,w,E,S;return s(this,(function(s){switch(s.label){case 0:return r&&r.method&&"GET"!==r.method.toUpperCase()&&r.headers&&"string"==typeof r.body&&(a=function(t){for(var e=0,r=Object.keys(t);e<r.length;e++){var n=r[e];if("content-type"===n.toLowerCase())return t[n]}return null}(r.headers))&&"application/json"===a.toLowerCase()&&"object"==typeof(c=JSON.parse(r.body))&&(r.body=JSON.stringify(o({__numberOfAttempts:t},c))),l="string"==typeof e?e:e.url,f=r&&r.method||"string"!=typeof e&&e.method||"get",v=(h=JSON).parse,(y=r&&r.body)?[3,3]:(b="string"!=typeof e)?[4,e.clone().text()]:[3,2];case 1:b=s.sent(),s.label=2;case 2:y=b,s.label=3;case 3:d=v.apply(h,[y.toString()])||void 0,s.label=4;case 4:return s.trys.push([4,8,9,10]),[4,fetch(e,o(o({},r),{credentials:(null==r?void 0:r.credentials)||"omit"}))];case 5:return m=s.sent(),(_=i)?[4,i(m)]:[3,7];case 6:_=!s.sent(),s.label=7;case 7:if(g=_,!m.ok||g)throw w=g?"Failed response validation":m.statusText,new p(w,l,f,d,m.status);return[2,m];case 8:if((E=s.sent())instanceof p)throw E;throw new p(E.message||"Unexpected fetch error",l,f,d);case 9:return n&&u(null===(S=null==r?void 0:r.headers)||void 0===S?void 0:S.Authorization),[7];case 10:return[2]}}))}))},[2,(0,c.default)(d,t)]}))}))}};var d=(0,e.fRetry)({retries:5});e.default=d},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){void 0===e&&(e=localStorage),this.name=t,this.storage=e}return t.prototype.get=function(){try{var t=this.storage.getItem(this.name);if(null!==t)return JSON.parse(t)}catch(t){console.error(t)}return null},t.prototype.set=function(t){try{this.storage.setItem(this.name,JSON.stringify(t))}catch(t){console.error(t)}},t.prototype.clear=function(){try{this.storage.removeItem(this.name)}catch(t){console.error(t)}},t}();e.default=n},function(t,e){var r=1e3,n=6e4,i=60*n,o=24*i;function a(t,e,r,n){var i=e>=1.5*r;return Math.round(t/r)+" "+n+(i?"s":"")}t.exports=function(t,e){e=e||{};var s=typeof t;if("string"===s&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var a=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return 6048e5*a;case"days":case"day":case"d":return a*o;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*n;case"seconds":case"second":case"secs":case"sec":case"s":return a*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(t);if("number"===s&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=o)return a(t,e,o,"day");if(e>=i)return a(t,e,i,"hour");if(e>=n)return a(t,e,n,"minute");if(e>=r)return a(t,e,r,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=o)return Math.round(t/o)+"d";if(e>=i)return Math.round(t/i)+"h";if(e>=n)return Math.round(t/n)+"m";if(e>=r)return Math.round(t/r)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.clearStatus=e.getStatus=e.setStatus=void 0;var i=new(n(r(2)).default)("MOL-FE-WEB-PUSH_SUBSCRIPTION_STATUS");e.setStatus=function(t,e){i.set({metadata:e,state:t})};e.getStatus=function(){return i.get()};e.clearStatus=function(){return i.clear()}},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.trackClientErrors=e.clear=e.addError=e.getErrors=e.setBaseEndpoint=void 0;var u,c=r(8),l=s(r(0)),f=s(r(2)),p=s(r(1)),d=new f.default("MOL-FE-WEB-PUSH_CLIENT_SUBSCRIPTION_ERRORS",sessionStorage);e.setBaseEndpoint=function(t){return u=t};e.getErrors=function(){return d.get()};e.addError=function(t){var r=(0,c.serializeError)(t),n=(0,e.getErrors)();(null==n?void 0:n.find((function(t){return JSON.stringify(t)===JSON.stringify(r)})))||d.set(a(a([],n||[],!0),[r],!1))};e.clear=function(){return d.clear()};e.trackClientErrors=function(t){return i(void 0,void 0,void 0,(function(){var r,i,a,s,c;return o(this,(function(o){switch(o.label){case 0:if(!(r=(0,e.getErrors)())||0===r.length)return[2];o.label=1;case 1:return o.trys.push([1,3,,4]),i=(0,l.default)(u,"analytics/client/error"),a={body:JSON.stringify({errors:r}),headers:{"Content-type":"application/json"},method:"post"},t&&(a.headers=n(n({},a.headers),{Authorization:t})),[4,(0,p.default)(i,a,!1)];case 2:if(!(s=o.sent()).ok)throw new Error(s.statusText);return(0,e.clear)(),[3,4];case 3:return c=o.sent(),console.error("Track Client Errors",c),[3,4];case 4:return[2]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.replaceSubscription=e.updatePushSubscription=e.requestPushNotificationPermission=e.subscribePushNotifications=e.registerPushSubscription=e.willExpireSoon=e.needsMigration=e.isWebPushSupported=void 0;var s=r(11),u=a(r(19)),c=a(r(1)),l=a(r(9));e.isWebPushSupported=function(){return"serviceWorker"in navigator&&"PushManager"in window};e.needsMigration=function(t,e){return t.options.applicationServerKey instanceof ArrayBuffer&&!(0,u.default)(e,new Uint8Array(t.options.applicationServerKey,0))};e.willExpireSoon=function(t){return!!t.expirationTime&&t.expirationTime<Date.now()+6048e5};e.registerPushSubscription=function(t,e,r){var a=e.subscription,u=e.metadata;return i(void 0,void 0,void 0,(function(){var e,i;return o(this,(function(o){return function(t){var e,r;try{e=t.getKey("auth"),r=t.getKey("p256dh")}catch(e){return console.error("Unable to get auth and p256dh keys, subscription ".concat(JSON.stringify(t,null,2))),!1}return null!==e&&null!==r}(a)?(e={metadata:n(n({},u),{browserLanguage:navigator.language,firedPromptEventActions:s.firedPromptEventActions,subscribedUrl:location.href}),subscription:a},i={body:JSON.stringify(e),headers:{"Content-type":"application/json"},method:"POST",mode:"cors"},r&&(i.headers=n(n({},i.headers),{Authorization:"ApiKey ".concat(r)})),[2,(0,c.default)(t,i)]):[2,void 0]}))}))};e.subscribePushNotifications=function(t){var r=t.apiKey,n=t.appServerKey,a=t.metadata,s=t.subscriptionEndpoint,u=t.registration;return i(void 0,void 0,void 0,(function(){var t,i;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,u.pushManager.subscribe({applicationServerKey:n,userVisibleOnly:!0})];case 1:return t=o.sent(),[4,(0,e.registerPushSubscription)(s,{metadata:a,subscription:t},r)];case 2:return o.sent(),[2,t];case 3:throw i=o.sent(),new l.default(i.message,"register",i);case 4:return[2]}}))}))};e.requestPushNotificationPermission=function(){return i(void 0,void 0,void 0,(function(){return o(this,(function(t){return[2,new Promise((function(t,e){var r=Notification.requestPermission((function(e){t(e)}));r instanceof Promise&&r.then(t,e)}))]}))}))};e.updatePushSubscription=function(t,e,r){var a=e.subscription,s=e.metadata;return i(void 0,void 0,void 0,(function(){var e,i,u;return o(this,(function(o){switch(o.label){case 0:e={metadata:n(n({},s),{browserLanguage:navigator.language,subscribedUrl:location.href}),subscription:a},i={body:JSON.stringify(e),headers:{"Content-type":"application/json"},method:"PATCH",mode:"cors"},r&&(i.headers=n(n({},i.headers),{Authorization:"ApiKey ".concat(r)})),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,(0,c.default)(t,i)];case 2:return o.sent(),[3,4];case 3:throw u=o.sent(),new l.default(u.message,"update",u);case 4:return[2]}}))}))};e.replaceSubscription=function(t){var r=t.apiKey,n=t.appServerKey,a=t.metadata,s=t.registration,u=t.subscription,c=t.subscriptionEndpoint;return i(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,u.unsubscribe()];case 1:return t.sent(),[2,(0,e.subscribePushNotifications)({apiKey:r,appServerKey:n,metadata:a,registration:s,subscriptionEndpoint:c})]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=o(r(18));e.default=function(t,e,r){return n(void 0,void 0,void 0,(function(){var n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(0,a.default)(t,e,r)];case 1:return i.sent(),[3,3];case 2:return n=i.sent(),console.error("TrackEvent Error",n),[3,3];case 3:return[2]}}))}))}},function(t,e,r){"use strict";class n extends Error{constructor(t){super(n._prepareSuperMessage(t)),Object.defineProperty(this,"name",{value:"NonError",configurable:!0,writable:!0}),Error.captureStackTrace&&Error.captureStackTrace(this,n)}static _prepareSuperMessage(t){try{return JSON.stringify(t)}catch(e){return String(t)}}}const i=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0}],o=({from:t,seen:e,to_:r,forceEnumerable:n})=>{const a=r||(Array.isArray(t)?[]:{});e.push(t);for(const[r,i]of Object.entries(t))"function"!=typeof i&&(i&&"object"==typeof i?e.includes(t[r])?a[r]="[Circular]":a[r]=o({from:t[r],seen:e.slice(),forceEnumerable:n}):a[r]=i);for(const{property:e,enumerable:r}of i)"string"==typeof t[e]&&Object.defineProperty(a,e,{value:t[e],enumerable:!!n||r,configurable:!0,writable:!0});return a};t.exports={serializeError:t=>"object"==typeof t&&null!==t?o({from:t,seen:[],forceEnumerable:!0}):"function"==typeof t?`[Function: ${t.name||"anonymous"}]`:t,deserializeError:t=>{if(t instanceof Error)return t;if("object"==typeof t&&null!==t&&!Array.isArray(t)){const e=new Error;return o({from:t,seen:[],to_:e}),e}return new n(t)}}},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(r,n,i){var o=t.call(this,r)||this;return Object.setPrototypeOf?Object.setPrototypeOf(o,e.prototype):o.__proto__=e.prototype,o.type=n,o.cause=i,o}return i(e,t),e}(Error);e.default=o},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.handleRegisterError=void 0;var i=r(8);r(5);e.handleRegisterError=function(t,e){var r=e.emit,o=e.metadata,a=e.rawAppServerKey;r("error",n(n({},(0,i.serializeError)(t)),{organisation:null==o?void 0:o.organisation,rawAppServerKey:a,userAgent:navigator.userAgent}))}},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.firedPromptEventActions=e.LAST_PROMPT_EPOCH=void 0;var s=a(r(3)),u=r(6),c=r(4),l=a(r(7)),f=a(r(12));e.LAST_PROMPT_EPOCH="mol-fe-browser-notifications-last-prompt-epoch";e.firedPromptEventActions=[],e.default=function(t,r){return i(void 0,void 0,void 0,(function(){var a,p,d,h,v,y,b,m,g,_,w,E,S,P,A,O,T,I,k,C,x,M,N,j,L;return o(this,(function(D){switch(D.label){case 0:a=r.apiKey,p=r.appServerKey,d=r.emit,h=r.metadata,v=r.baseEndpoint,y=r.subscriptionEndpoint,b=r.promptFrequency,m=r.rawAppServerKey,g=r.renderPrePrompt,D.label=1;case 1:return D.trys.push([1,12,,13]),_=h.channels,w=h.crossOrgUserIds,E=h.platform,S=h.subChannels,P=h.userAgent,A=h.visitorIds,O=Array.isArray(A)?A[0]:void 0,T=Array.isArray(w)?w[0]:void 0,I=Array.isArray(_)?_[0]:void 0,k=Array.isArray(S)?S[0]:void 0,C=function(t){return n({channel:I,crossOrgUserId:T,organisation:h.organisation,platform:E,subChannel:k,type:"prompt",userAgent:P,visitorId:O},t)},x=function(t){return i(void 0,void 0,void 0,(function(){var r,n;return o(this,(function(i){switch(i.label){case 0:return r=t.action,"prompt",n=C(t),e.firedPromptEventActions.push(r),d("".concat("prompt","_").concat(r),n),[4,(0,l.default)(v,n,a)];case 1:return i.sent(),[2]}}))}))},function(t){if(!t)return!0;var r=(0,s.default)(t);if("number"!=typeof r)throw new TypeError("Prompt frequency must be a valid string like `1d` or `1h`");if(!("localStorage"in window))return!0;var n=JSON.parse(window.localStorage.getItem(e.LAST_PROMPT_EPOCH)||"0");return Date.now()-n>=r}(b)?[3,2]:(d("prompt_discarded",C({action:"discarded",permission:Notification.permission,type:"prompt"})),[3,11]);case 2:return"default"!==Notification.permission?[3,8]:(M=function(){return i(void 0,void 0,void 0,(function(){var e,r;return o(this,(function(n){switch(n.label){case 0:return[4,x({action:"impression",permission:Notification.permission})];case 1:return n.sent(),[4,(0,u.requestPushNotificationPermission)()];case 2:return e=n.sent(),r=[x({action:"click",permission:e})],"granted"===e&&r.push((0,u.subscribePushNotifications)({apiKey:a,appServerKey:p,metadata:h,registration:t,subscriptionEndpoint:y})),[4,Promise.all(r)];case 3:return n.sent(),[2]}}))}))},"function"!=typeof g?[3,5]:[4,x({action:"pre_prompt_impression",permission:Notification.permission})]);case 3:return D.sent(),[4,new Promise((function(t){g((function(e){return i(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,x({action:"pre_prompt_click",permission:e?"granted":"denied"})];case 1:return r.sent(),e?[4,M()]:[3,3];case 2:r.sent(),r.label=3;case 3:return t(e),[2]}}))}))}))}))];case 4:return D.sent(),[3,7];case 5:return[4,M()];case 6:D.sent(),D.label=7;case 7:"localStorage"in window&&window.localStorage.setItem(e.LAST_PROMPT_EPOCH,JSON.stringify(Date.now())),D.label=8;case 8:return"granted"!==Notification.permission?[3,10]:[4,t.pushManager.getSubscription()];case 9:return N=D.sent(),j={subscription:N,type:"web-push-sw-subscription-ready"},t.active.postMessage(JSON.stringify(j)),(0,c.setStatus)("ready",h),[3,11];case 10:"default"===Notification.permission?(0,c.setStatus)("undecided",h):(0,c.clearStatus)(),D.label=11;case 11:return[3,13];case 12:return L=D.sent(),(0,f.default)(L,{emit:d,metadata:h,rawAppServerKey:m}),[3,13];case 13:return[2]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=n(r(9)),o=r(4),a=r(10);e.default=function(t,e){if(t instanceof i.default){var r=e.metadata;"register"===t.type?(0,o.setStatus)("register_pending",r):"update"===t.type&&(0,o.setStatus)("update_pending",r)}(0,a.handleRegisterError)(t,e)}},function(t,e,r){"use strict";const n=r(14);class i extends Error{constructor(t){super(),t instanceof Error?(this.originalError=t,({message:t}=t)):(this.originalError=new Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}}const o=(t,e)=>new Promise((r,o)=>{e={onFailedAttempt:()=>{},retries:10,...e};const a=n.operation(e);a.attempt(async n=>{try{r(await t(n))}catch(t){if(!(t instanceof Error))return void o(new TypeError(`Non-error was thrown: "${t}". You should only throw errors.`));if(t instanceof i)a.stop(),o(t.originalError);else if(t instanceof TypeError)a.stop(),o(t);else{((t,e,r)=>{const n=r.retries-(e-1);t.attemptNumber=e,t.retriesLeft=n})(t,n,e);try{await e.onFailedAttempt(t)}catch(t){return void o(t)}a.retry(t)||o(a.mainError())}}})});t.exports=o,t.exports.default=o,t.exports.AbortError=i},function(t,e,r){t.exports=r(15)},function(t,e,r){var n=r(16);e.operation=function(t){var r=e.timeouts(t);return new n(r,{forever:t&&t.forever,unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},e.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in t)e[r]=t[r];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<e.retries;i++)n.push(this.createTimeout(i,e));return t&&t.forever&&!n.length&&n.push(this.createTimeout(i,e)),n.sort((function(t,e){return t-e})),n},e.createTimeout=function(t,e){var r=e.randomize?Math.random()+1:1,n=Math.round(r*e.minTimeout*Math.pow(e.factor,t));return n=Math.min(n,e.maxTimeout)},e.wrap=function(t,r,n){if(r instanceof Array&&(n=r,r=null),!n)for(var i in n=[],t)"function"==typeof t[i]&&n.push(i);for(var o=0;o<n.length;o++){var a=n[o],s=t[a];t[a]=function(n){var i=e.operation(r),o=Array.prototype.slice.call(arguments,1),a=o.pop();o.push((function(t){i.retry(t)||(t&&(arguments[0]=i.mainError()),a.apply(this,arguments))})),i.attempt((function(){n.apply(t,o)}))}.bind(t,s),t[a].options=r}}},function(t,e){function r(t,e){"boolean"==typeof e&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=(new Date).getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),r=this._timeouts.shift()}var n=this,i=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r);return this._options.unref&&i.unref(),!0},r.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},r.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,r=0,n=0;n<this._errors.length;n++){var i=this._errors[n],o=i.message,a=(t[o]||0)+1;t[o]=a,a>=r&&(e=i,r=a)}return e}},function(t,e,r){"use strict";function n(t){return"function"==typeof t?t():t}function i(){var t={};return t.promise=new Promise((function(e,r){t.resolve=e,t.reject=r})),t}t.exports=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=void 0,a=void 0,s=void 0,u=[];return function(){var l=n(e),f=(new Date).getTime(),p=!o||f-o>l;o=f;for(var d=arguments.length,h=Array(d),v=0;v<d;v++)h[v]=arguments[v];if(p&&r.leading)return r.accumulate?Promise.resolve(t.call(this,[h])).then((function(t){return t[0]})):Promise.resolve(t.call.apply(t,[this].concat(h)));if(a?clearTimeout(s):a=i(),u.push(h),s=setTimeout(c.bind(this),l),r.accumulate){var y=u.length-1;return a.promise.then((function(t){return t[y]}))}return a.promise};function c(){var e=a;clearTimeout(s),Promise.resolve(r.accumulate?t.call(this,u):t.apply(this,u[u.length-1])).then(e.resolve,e.reject),u=[],a=null}}},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=a(r(0)),u=a(r(1));e.default=function(t,e,r){return i(void 0,void 0,void 0,(function(){var i,a,c,l;return o(this,(function(o){return i=e.type,a=e.action,c=(0,s.default)(t,"analytics/track",i,a),l={body:JSON.stringify(e),headers:{"Content-type":"application/json"},method:"post",mode:"cors"},r&&(l.headers=n(n({},l.headers),{Authorization:"ApiKey ".concat(r)})),[2,(0,u.default)(c,l)]}))}))}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t,e){if(t.byteLength!==e.byteLength)return!1;for(var r=0;r!==t.byteLength;r++)if(t[r]!==e[r])return!1;return!0}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){switch(t){case"production":return"https://hulkprod.anm.co.uk/api/web-push-notification";case"integration":return"https://hulkint.anm.co.uk/api/web-push-notification";default:return"/public"}}},function(t,e,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(e,r);i&&!("get"in i?!e.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,i)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),i=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||n(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),i(r(37),e),i(r(38),e),i(r(39),e),i(r(40),e),i(r(41),e)},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var o=n(void 0,void 0,void 0,(function(){return i(this,(function(t){return[2,new Promise((function(t){"interactive"===document.readyState&&Boolean(document.body)||"complete"===document.readyState?t():document.addEventListener("DOMContentLoaded",(function(){t()}))}))]}))}));e.default=o},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.SetIntervalAsyncTimer=void 0;var a=function(){function t(){this.timeout=void 0,this.promise=void 0,this.stopped=!1}return t.startTimer=function(e,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var a=Math.min(Math.max(Math.trunc(r),10),2147483647),s=new t;return s.scheduleTimeout.apply(s,o([e,a,a],n,!1)),s},t.stopTimer=function(t){return n(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return t.stopped=!0,t.timeout&&clearTimeout(t.timeout),t.promise?[4,t.promise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.scheduleTimeout=function(t,e,r){for(var a=this,s=[],u=3;u<arguments.length;u++)s[u-3]=arguments[u];this.timeout=setTimeout((function(){return n(a,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return this.timeout=void 0,this.promise=this.runHandlerAndScheduleTimeout.apply(this,o([t,e],s,!1)),[4,this.promise];case 1:return r.sent(),this.promise=void 0,[2]}}))}))}),r)},t.prototype.runHandlerAndScheduleTimeout=function(t,e){for(var r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];return n(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,3,4]),[4,t.apply(void 0,r)];case 1:return n.sent(),[3,4];case 2:return n.sent(),[3,4];case 3:return this.stopped||this.scheduleTimeout.apply(this,o([t,e,e],r,!1)),[7];case 4:return[2]}}))}))},t}();e.SetIntervalAsyncTimer=a},function(t,e,r){"use strict";var n=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.deleteOldClickRecords=e.getAll=e.clear=e.wasTrackedBefore=e.markAsTracked=e.storage=void 0;var o=i(r(3)),a=i(r(2));e.storage=new a.default("MOL-FE-WEB-PULL_NOTIFICATION_CLICKS");e.markAsTracked=function(t,r){var i=e.storage.get()||[];return e.storage.set(n(n([],i,!0),[{campaignId:t,crossOrgUserId:r,epoch:Date.now()}],!1))};e.wasTrackedBefore=function(t,r){return(e.storage.get()||[]).some((function(e){return e.campaignId===t&&e.crossOrgUserId===r}))};e.clear=function(){return e.storage.clear()};e.getAll=function(){return e.storage.get()||[]};e.deleteOldClickRecords=function(){var t=e.storage.get()||[];e.storage.set(t.filter((function(t){var e=t.epoch;return Date.now()-e<(0,o.default)("24h")})))}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(44);e.default=function(t){var e=(0,n.getISOStringParts)(t).map((function(t){return parseInt(t,10)})),r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6];return new Date(Date.UTC(r,i-1,o,a,s,u,c||0))}},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),o=this&&this.__assign||function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},a=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Register=void 0;var c=u(r(0)),l=u(r(27)),f=u(r(28)),p=u(r(30)),d=u(r(11)),h=u(r(20)),v=r(6),y=u(r(32)),b=r(33),m=r(54),g=function(t){function e(e){var r=t.call(this)||this;r.appServerKey=null,r.registration=null;var n=e.environment?(0,h.default)(e.environment):e.baseEndpoint||"";return r.options=(0,y.default)(o({},e)),r.baseEndpoint=(0,c.default)(n,"/v1/organisation",r.options.metadata.organisation),r.subscriptionEndpoint=(0,c.default)(r.baseEndpoint,"subscription"),r}return i(e,t),e.isWebPushSupported=function(){return(0,v.isWebPushSupported)()},e.prototype.getAppServerKey=function(t){return void 0===t&&(t=!1),a(this,void 0,void 0,(function(){var e;return s(this,(function(r){switch(r.label){case 0:return null===this.appServerKey||t?(e=this,[4,(0,f.default)((0,c.default)(this.subscriptionEndpoint,"publicKey"),this.options.apiKey)]):[3,2];case 1:e.appServerKey=r.sent(),r.label=2;case 2:return[2,this.appServerKey]}}))}))},e.prototype.getCrossOrgUserId=function(){return a(this,void 0,void 0,(function(){var t,e=this;return s(this,(function(r){switch(r.label){case 0:return this.crossOrguserId?[3,2]:(t=this,[4,(0,m.getCrossOrgUserId)(this.options.metadata,(function(t,r){return e.emit(t,r)}))]);case 1:t.crossOrguserId=r.sent(),r.label=2;case 2:return[2,this.crossOrguserId]}}))}))},e.prototype.init=function(){return a(this,void 0,void 0,(function(){var t,e,r,n,i,a,u,c=this;return s(this,(function(s){switch(s.label){case 0:return[4,this.getAppServerKey()];case 1:return t=s.sent()||{},e=t.parsed,r=t.raw,n=this,i=p.default,a=[o({},this.options)],u={appServerKey:e,baseEndpoint:this.baseEndpoint},[4,this.getCrossOrgUserId()];case 2:return[4,i.apply(void 0,[o.apply(void 0,a.concat([(u.crossOrgUserId=s.sent(),u.emit=function(t,e){return c.emit(t,e)},u.rawAppServerKey=r,u.subscriptionEndpoint=this.subscriptionEndpoint,u)]))])];case 3:return n.registration=s.sent(),[2,this.registration]}}))}))},e.prototype.initPullNotifications=function(t){var e=t.renderPullNotification,r=t.canRender;return a(this,void 0,void 0,(function(){var t,n,i=this;return s(this,(function(a){switch(a.label){case 0:if("function"!=typeof e)throw new TypeError("Missing required option `renderPullNotification` function");if(r&&"function"!=typeof r)throw new TypeError("Optional `canRender` option must be a function");return t=b.init,n={apiKey:this.options.apiKey,baseEndpoint:this.baseEndpoint,canRender:r},[4,this.getCrossOrgUserId()];case 1:return[4,t.apply(void 0,[(n.crossOrgUserId=a.sent(),n.emit=function(t,e){return i.emit(t,e)},n.metadata=o({geo:"ALL"},this.options.metadata),n.renderPullNotification=e,n)])];case 2:return a.sent(),[2,this]}}))}))},e.prototype.showPrompt=function(t){return a(this,void 0,void 0,(function(){var e,r,n,i=this;return s(this,(function(a){switch(a.label){case 0:return[4,this.getAppServerKey()];case 1:if(e=a.sent()||{},r=e.parsed,n=e.raw,null===this.registration)throw new Error("Init must be called before attempting to call showPrompt");return[2,(0,d.default)(this.registration,o(o({},this.options),{appServerKey:r,baseEndpoint:this.baseEndpoint,emit:function(t,e){return i.emit(t,e)},rawAppServerKey:n,renderPrePrompt:t,subscriptionEndpoint:this.subscriptionEndpoint}))]}}))}))},e}(l.default);e.Register=g},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.events={},this.logger=t||console}return t.prototype.on=function(t,e){var r=this.events;return(r[t]||(r[t]=[])).push(e),this},t.prototype.removeListener=function(t,e){var r=this.events,n=r[t]||(r[t]=[]);return r[t]=n.filter((function(t){return t!==e})),this},t.prototype.removeAllListeners=function(t){return t?this.events[t]=null:this.events={},this},t.prototype.emit=function(t){for(var e=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var i=this.events,o=i[t]||(i[t]=[]),a=o.length>0,s=r;try{s=JSON.parse(JSON.stringify(r))}catch(t){}return o.forEach((function(t){try{t.apply(void 0,s)}catch(t){e.logger.error(t,t.stack)}})),a},t}();e.default=n},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=o(r(29)),s=o(r(1));e.default=function(t,e){return n(void 0,void 0,void 0,(function(){var r,o;return i(this,(function(u){switch(u.label){case 0:return r={mode:"cors"},e&&(r.headers={Authorization:"ApiKey ".concat(e)}),[4,(0,s.default)(t,r,!0,(function(t){return n(void 0,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,t.clone().text()];case 1:return[2,""!==e.sent().trim()]}}))}))}))];case 1:return[4,u.sent().text()];case 2:return o=u.sent(),[2,{parsed:(0,a.default)(o),raw:o}]}}))}))}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),r=function(){try{return window.atob(),!0}catch(t){return!1}}()?function(t){var e,r,n,i={},o=0,a=0,s="",u=t.length;for(e=0;e<64;e++)i["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)]=e;for(r=0;r<u;r++)for(o=(o<<6)+(e=i[t.charAt(r)]),a+=6;a>=8;)((n=255&o>>>(a-=8))||u-2>r)&&(s+=String.fromCharCode(n));return s}(e):window.atob(e),n=new Uint8Array(r.length),i=0;i<r.length;++i)n[i]=r.charCodeAt(i);return n}},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},a=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var u=s(r(22)),c=r(6),l=r(4),f=s(r(12)),p=r(5),d=s(r(7)),h=r(31),v=function(t){var e;if(t&&"object"==typeof t&&0!==Object.keys(t).length)return{impression:null===(e=t.impression)||void 0===e?void 0:e.filter((function(t){return"string"==typeof t||Array.isArray(t)&&"string"==typeof t[0]}))}};e.default=function(t){return i(void 0,void 0,void 0,(function(){var e,r,i,s,y,b,m,g,_,w,E,S,P,A,O,T,I,k,C,x,M,N,j,L,D,R,U,G,B,K,H,F;return o(this,(function(o){switch(o.label){case 0:e=t.apiKey,r=t.appServerKey,i=t.notificationMacros,s=t.emit,y=t.metadata,b=t.baseEndpoint,m=t.swUrl,g=t.subscriptionEndpoint,_=t.rawAppServerKey,w=t.crossOrgUserId,E=Array.isArray(y.visitorIds)?y.visitorIds[0]:void 0,S=y.userAgent,o.label=1;case 1:return o.trys.push([1,20,,21]),[4,u.default];case 2:return o.sent(),(0,h.deleteOldClickRecords)(),P=new URLSearchParams(window.location.search),A=P.get("ito"),(0,p.setBaseEndpoint)(b),O=(0,l.getStatus)(),T=w?[w]:void 0,y.crossOrgUserIds=T,"push-notification"!==A?[3,4]:(I=P.get("ci"),k=P.get("cri")||"",C=P.get("si"),x=P.get("ai"),M=P.get("xi"),I&&C?(N=function(t){var e=t.sharedCrossOrgUserId,r=t.crossOrgUserId,n=t.campaignId,i=t.subscriptionId;return e?r!==e?"click_page_share":(0,h.wasTrackedBefore)(n,i)?"click_page_refresh":"click":"click"}({campaignId:I,crossOrgUserId:w,sharedCrossOrgUserId:M,subscriptionId:C}),j={action:N,campaignId:I,campaignRunId:k,crossOrgUserId:w,organisation:y.organisation,platform:y.platform,subscriptionId:C,type:"notification",userAgent:S,visitorId:E},x&&(j.assetId=x),s("notification_click",j),[4,(0,d.default)(b,n(n({},j),{action:"click"===N?"click_page_load":N}),e)]):[3,4]);case 3:o.sent(),(0,h.markAsTracked)(I,C),o.label=4;case 4:if(!m)return[3,8];o.label=5;case 5:return o.trys.push([5,7,,8]),[4,navigator.serviceWorker.register(m,{scope:"/"})];case 6:return o.sent(),[3,8];case 7:return L=o.sent(),console.error("ServiceWorker registration failed: ",L),[3,8];case 8:return[4,navigator.serviceWorker.ready];case 9:return[4,(D=o.sent()).pushManager.getSubscription()];case 10:return R=o.sent(),U=!!R&&(0,c.needsMigration)(R,r),O=(0,l.getStatus)(),G={apiKey:e,baseEndpoint:b,crossOrgUserId:w,navigatorPlatform:window.navigator.platform,notificationMacros:v(i),organisation:y.organisation,permission:Notification.permission,subscription:U?null:R,type:"web-push-sw-init-data",userAgent:y.userAgent,visitorId:E},D.active.postMessage(JSON.stringify(G)),O&&"undecided"===O.state&&"granted"===Notification.permission&&((0,l.setStatus)("register_pending",O.metadata),O=(0,l.getStatus)()),O&&"undecided"!==O.state&&O.metadata&&(O.metadata.userAgent!==y.userAgent||O.metadata.profilingAllowed!==y.profilingAllowed||(O.metadata.visitorIds||[]).join(",")!==(y.visitorIds||[]).join(",")||(O.metadata.crossOrgUserIds||[]).join(",")!==(T||[]).join(",")||"push-notification"===A)&&(K=n(n({},O.metadata),{crossOrgUserIds:Array.from(new Set(a(a([],O.metadata.crossOrgUserIds||[],!0),T||[],!0))),keywords:Array.from(new Set(a(a([],O.metadata.keywords||[],!0),y.keywords||[],!0))),profilingAllowed:y.profilingAllowed,userAgent:y.userAgent,visitorIds:Array.from(new Set(a(a([],O.metadata.visitorIds||[],!0),y.visitorIds||[],!0)))}),B="ready"===O.state?"update_pending":O.state,(0,l.setStatus)(B,K),O=(0,l.getStatus)()),R?(K=O?O.metadata:y,U||(0,c.willExpireSoon)(R)?[4,(0,c.replaceSubscription)({apiKey:e,appServerKey:r,metadata:n(n({},y),{migrated:U,migratedSubscriptionEndpoint:U?R.endpoint:void 0}),registration:D,subscription:R,subscriptionEndpoint:g})]:[3,12]):[3,17];case 11:return o.sent(),[3,16];case 12:return O&&"register_pending"===O.state?[4,(0,c.registerPushSubscription)(g,{metadata:K,subscription:R},e)]:[3,14];case 13:return o.sent(),[3,16];case 14:return O&&"update_pending"===O.state||!O?[4,(0,c.updatePushSubscription)(g,{metadata:K,subscription:R},e)]:[3,16];case 15:o.sent(),o.label=16;case 16:return(0,l.setStatus)("ready",y),[3,19];case 17:return"granted"!==Notification.permission?[3,19]:(H=O?O.metadata:y,[4,(0,c.subscribePushNotifications)({apiKey:e,appServerKey:r,metadata:H,registration:D,subscriptionEndpoint:g})]);case 18:o.sent(),(0,l.setStatus)("ready",H),o.label=19;case 19:return[2,D];case 20:return F=o.sent(),(0,f.default)(F,{emit:s,metadata:y,rawAppServerKey:_}),[3,21];case 21:return[2,null]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.deleteOldClickRecords=e.getAll=e.clear=e.wasTrackedBefore=e.markAsTracked=e.storage=void 0;var o=i(r(3)),a=i(r(2));e.storage=new a.default("MOL-FE-WEB-PUSH_NOTIFICATION_CLICKS");e.markAsTracked=function(t,r){var i=e.storage.get()||[];return e.storage.set(n(n([],i,!0),[{campaignId:t,epoch:Date.now(),subscriptionId:r}],!1))};e.wasTrackedBefore=function(t,r){return(e.storage.get()||[]).some((function(e){return e.campaignId===t&&e.subscriptionId===r}))};e.clear=function(){return e.storage.clear()};e.getAll=function(){return e.storage.get()||[]};e.deleteOldClickRecords=function(){var t=e.storage.get()||[];e.storage.set(t.filter((function(t){var e=t.epoch;return Date.now()-e<(0,o.default)("24h")})))}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e){return void 0===e&&(e=0),"string"!=typeof t||0===t.length||e&&e<t.length},i=function(t){return!Array.isArray(t)||t.length&&t.map(n).every(Boolean)},o=["organisation","platform","profilingAllowed","userAgent"];e.default=function(t){var e,r,a,s,u,c,l,f,p,d,h,v,y,b;if(function(t,e){if(null!==t&&"object"===typeof t){var r=Object.keys(t),n=e&&e.map((function(t){return r.includes(t)})).filter(Boolean).length===e.length;return!r.length||!n}return!0}(t.metadata,o))throw new Error("metadata is required and must be object containing the following required fields ".concat(o.join(", "),"."));if(n(null===(e=t.metadata)||void 0===e?void 0:e.organisation))throw new Error("metadata.organisation is required and must be a non empty string.");if(n(null===(r=t.metadata)||void 0===r?void 0:r.platform))throw new Error("metadata.platform is required and must be a non empty string.");if("boolean"!=typeof(null===(a=t.metadata)||void 0===a?void 0:a.profilingAllowed))throw new Error("metadata.profilingAllowed is required and must be a boolean.");if(n(null===(s=t.metadata)||void 0===s?void 0:s.userAgent))throw new Error("metadata.userAgent is required and must be a non empty string.");if(void 0!==t.swUrl&&n(t.swUrl))throw new Error("swUrl is optional but must be non empty string when provided.");if(void 0!==(null===(u=t.metadata)||void 0===u?void 0:u.visitorIds)&&i(null===(c=t.metadata)||void 0===c?void 0:c.visitorIds))throw new Error("metadata.visitorIds is optional but must be a non empty string array.");if(void 0!==(null===(l=t.metadata)||void 0===l?void 0:l.crossOrgUserIds)&&i(null===(f=t.metadata)||void 0===f?void 0:f.crossOrgUserIds))throw new Error("metadata.crossOrgUserIds is optional but must be a non empty string array.");if(void 0!==(null===(p=t.metadata)||void 0===p?void 0:p.keywords)&&i(null===(d=t.metadata)||void 0===d?void 0:d.keywords))throw new Error("metadata.keywords is optional but must be a non empty string array when provided.");if(void 0!==(null===(h=t.metadata)||void 0===h?void 0:h.channels)&&i(null===(v=t.metadata)||void 0===v?void 0:v.channels))throw new Error("metadata.channels is optional but must be a non empty string array when provided.");if(void 0!==(null===(y=t.metadata)||void 0===y?void 0:y.subChannels)&&i(null===(b=t.metadata)||void 0===b?void 0:b.subChannels))throw new Error("metadata.subChannels is optional but must be a non empty string array when provided.");return t}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.init=void 0;var a=o(r(3)),s=o(r(22)),u=r(34),c=r(10),l=r(24),f=r(36),p=r(53);e.init=function(t){return n(void 0,void 0,void 0,(function(){var e,r,o,d,h,v,y,b;return i(this,(function(m){switch(m.label){case 0:e=(0,f.pullNotifierFactory)(t).showPullNotification,r=null,o=function(){return n(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,e()];case 1:return t.sent(),r=(0,u.setIntervalAsync)(e,(0,a.default)("30s")),[2]}}))}))},d=function(){return n(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return r?[4,(0,u.clearIntervalAsync)(r)]:[3,2];case 1:t.sent(),r=null,t.label=2;case 2:return[2]}}))}))},h=function(){return n(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return"hidden"!==document.visibilityState?[3,2]:[4,d()];case 1:t.sent(),t.label=2;case 2:return"visible"!==document.visibilityState||r?[3,4]:[4,o()];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))},v=function(){return n(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return document.removeEventListener("visibilitychange",h),[4,d()];case 1:return t.sent(),[2]}}))}))},m.label=1;case 1:return m.trys.push([1,7,,8]),[4,s.default];case 2:return m.sent(),(0,l.deleteOldClickRecords)(),y=new URLSearchParams(window.location.search),"pull-notification"!==y.get("ito")?[3,4]:[4,(0,p.trackPullNotificationClickLoad)(y,t)];case 3:m.sent(),m.label=4;case 4:return"visible"!==document.visibilityState?[3,6]:[4,o()];case 5:m.sent(),m.label=6;case 6:return document.addEventListener("visibilitychange",h),[3,8];case 7:return b=m.sent(),(0,c.handleRegisterError)(b,{emit:t.emit,metadata:t.metadata}),[3,8];case 8:return[2,{cleanup:v}]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.setIntervalAsync=e.clearIntervalAsync=void 0;var i=r(35);Object.defineProperty(e,"clearIntervalAsync",{enumerable:!0,get:function(){return i.clearIntervalAsync}});var o=r(23);e.setIntervalAsync=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if("function"!=typeof t)throw new TypeError("First argument is not a function");if("number"!=typeof e)throw new TypeError("Second argument is not a number");return o.SetIntervalAsyncTimer.startTimer.apply(o.SetIntervalAsyncTimer,n([t,e],r,!1))}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.clearIntervalAsync=void 0;var o=r(23);e.clearIntervalAsync=function(t){return n(void 0,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:if(!(t instanceof o.SetIntervalAsyncTimer))throw new TypeError("First argument is not an instance of SetIntervalAsyncTimer");return[4,o.SetIntervalAsyncTimer.stopTimer(t)];case 1:return e.sent(),[2]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.pullNotifierFactory=void 0;var a=r(21),s=o(r(3)),u=r(42),c=o(r(7)),l=r(43),f=r(52),p=function(t,e,r,o,s){return function(){return n(void 0,void 0,void 0,(function(){var n;return i(this,(function(i){switch(i.label){case 0:return n={action:t,campaignId:s.campaignId,crossOrgUserId:s.crossOrgUserId,organisation:s.organisation,platform:s.platform,type:"pull-notification",userAgent:navigator.userAgent},t!==a.PullNotificationEventAction.CLICK?[3,2]:[4,(0,c.default)(r,n,o)];case 1:i.sent(),i.label=2;case 2:return e("pull_notification_".concat(t),n),[2]}}))}))}};e.pullNotifierFactory=function(t){var e=t.apiKey,r=t.baseEndpoint,o=t.metadata,c=t.crossOrgUserId,d=t.renderPullNotification,h=t.emit,v=t.canRender,y=void 0===v?function(){return!0}:v,b=new u.HashStorage("hulk_pull-notification_shown_campaigns",(0,s.default)("24h"),1e3);return{showPullNotification:function(){return n(void 0,void 0,void 0,(function(){var t,n,u,v;return i(this,(function(i){switch(i.label){case 0:return[4,(0,l.getLatestPullCampaign)(r,o,e)];case 1:return(t=i.sent())&&!b.get(t.id)&&"visible"===document.visibilityState&&y(t)?(n=(0,f.getPullNotificationData)(o,t,c),u=p(a.PullNotificationEventAction.IMPRESSION,h,r,e,n),v=p(a.PullNotificationEventAction.CLICK,h,r,e,n),[4,d(n,{onClick:v})]):[3,4];case 2:return i.sent(),[4,u()];case 3:i.sent(),b.set(t.id,!0,(0,s.default)("24h")),i.label=4;case 4:return[2]}}))}))},storage:b}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RedisDB=void 0,function(t){t[t.MAIN=0]="MAIN",t[t.REDLOCK=1]="REDLOCK",t[t.SESSION=2]="SESSION"}(e.RedisDB||(e.RedisDB={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MetricsLogLevel=void 0,function(t){t.DEBUG="debug",t.INFO="info",t.WARN="warn",t.ERROR="error"}(e.MetricsLogLevel||(e.MetricsLogLevel={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PullNotificationEventAction=e.PullCampaignStatus=e.PullCampaignType=void 0,function(t){t.DEFAULT="DEFAULT",t.SCHEDULED="SCHEDULED"}(e.PullCampaignType||(e.PullCampaignType={})),function(t){t.SCHEDULED="SCHEDULED",t.ACTIVE="ACTIVE",t.CANCELED="CANCELED",t.FINISHED="FINISHED"}(e.PullCampaignStatus||(e.PullCampaignStatus={})),function(t){t.IMPRESSION="impression",t.CLICK="click",t.CLICK_PAGE_LOAD="click_page_load",t.CLICK_PAGE_SHARE="click_page_share",t.CLICK_PAGE_REFRESH="click_page_refresh"}(e.PullNotificationEventAction||(e.PullNotificationEventAction={}))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Pipeline=e.CampaignRunType=e.CampaignType=e.CampaignStatus=e.SubscriptionStatus=e.SubscriptionMigrationStatus=void 0,function(t){t[t.PENDING=1]="PENDING",t[t.PARTIAL=2]="PARTIAL",t[t.DONE=3]="DONE"}(e.SubscriptionMigrationStatus||(e.SubscriptionMigrationStatus={})),function(t){t.ACTIVE="ACTIVE",t.INACTIVE="INACTIVE",t.ZOMBIE="ZOMBIE",t.BATCH_TARGETED="BATCH_TARGETED"}(e.SubscriptionStatus||(e.SubscriptionStatus={})),function(t){t.READY="READY",t.STARTED="STARTED",t.CANCELED="CANCELED",t.SEARCHING="SEARCHING",t.DELIVERING="DELIVERING",t.FINISHED="FINISHED",t.SCHEDULED="SCHEDULED",t.SAMPLE_PROBING="SAMPLE_PROBING",t.AB_TESTING="AB_TESTING",t.WAITING="WAITING",t.CANCELED_BY_PROBE="CANCELED_BY_PROBE"}(e.CampaignStatus||(e.CampaignStatus={})),function(t){t.DEFAULT="DEFAULT",t.SCHEDULED_SAMPLE_PROBING="SCHEDULED_SAMPLE_PROBING",t.SAMPLE_PROBING="SAMPLE_PROBING",t.SCHEDULED_AB_TESTING="SCHEDULED_AB_TESTING",t.SCHEDULED_AB_TESTING_SAMPLE_PROBING="SCHEDULED_AB_TESTING_SAMPLE_PROBING",t.AB_TESTING_SAMPLE_PROBING="AB_TESTING_SAMPLE_PROBING",t.AB_TESTING="AB_TESTING",t.SCHEDULED="SCHEDULED",t.PING="PING",t.BATCH_CAMPAIGN="BATCH_CAMPAIGN"}(e.CampaignType||(e.CampaignType={})),function(t){t.DEFAULT="DEFAULT",t.SAMPLE_PROBE="SAMPLE_PROBE",t.AB_PROBE="AB_PROBE",t.PING="PING",t.BATCH_CAMPAIGN="BATCH_CAMPAIGN"}(e.CampaignRunType||(e.CampaignRunType={})),function(t){t.USER_AGENT="USER_AGENT"}(e.Pipeline||(e.Pipeline={}))},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.HashStorage=void 0;var i=n(r(3)),o=n(r(2)),a=function(){function t(t,e,r){void 0===e&&(e=(0,i.default)("24h")),void 0===r&&(r=1e3),this.name=t,this.storage=new o.default(t),this.defaultTTL=e,this.entriesLimit=r,this.syncHash()}return t.prototype.getHash=function(){return this.storage.get()||{}},t.prototype.syncHash=function(){for(var t=this.getHash(),e={},r=0,n=0,i=Object.entries(t).sort((function(t,e){return e[1].epoch-t[1].epoch}));n<i.length;n++){var o=i[n],a=o[0],s=o[1];Date.now()-s.epoch<s.ttl&&r<this.entriesLimit&&(e[a]=s,r+=1)}this.storage.set(e)},t.prototype.get=function(t){var e=this.getHash()[t];return e?e.data:null},t.prototype.set=function(t,e,r){var n=this.getHash(),i={data:e,epoch:Date.now(),ttl:r};n[t]=i,this.storage.set(n),this.syncHash()},t.prototype.clear=function(){this.storage.clear()},t}();e.HashStorage=a},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.getLatestPullCampaign=void 0;var a=o(r(25)),s=r(45);e.getLatestPullCampaign=function(t,e,r){return n(void 0,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,(0,s.fetchSegmentedPullCampaigns)(t,e,r)];case 1:return[2,n.sent().sort((function(t,e){var r=(0,a.default)(t.triggerTime||t.creationTimestamp).getTime();return(0,a.default)(e.triggerTime||e.creationTimestamp).getTime()-r}))[0]]}}))}))}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getISOStringParts=void 0;e.getISOStringParts=function(t){return t.split(/\D+/)}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.fetchSegmentedPullCampaigns=void 0;var o=r(46),a=r(47),s=r(48);e.fetchSegmentedPullCampaigns=function(t,e,r){return n(void 0,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,(0,o.fetchPullCampaigns)(t,r)];case 1:return[2,n.sent().filter((function(t){return(0,a.isActive)(e.platform,t)&&(0,s.matchesSegments)(e,t.segments)}))]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.fetchPullCampaigns=void 0;var a=o(r(0)),s=o(r(1));e.fetchPullCampaigns=function(t,e){return n(void 0,void 0,void 0,(function(){var r;return i(this,(function(n){switch(n.label){case 0:return r={mode:"cors"},e&&(r.headers={Authorization:"ApiKey ".concat(e)}),[4,(0,s.default)((0,a.default)(t,"pull-campaign"),r,!0)];case 1:return[2,n.sent().json()||[]]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.isActive=void 0;var i=r(21),o=n(r(25));e.isActive=function(t,e){if(!e.ttl)return!1;var r=1e3*("desktop"===t?e.ttl.desktop:e.ttl.mobile),n=e.type===i.PullCampaignType.SCHEDULED?e.triggerTime:e.creationTimestamp,a=(0,o.default)(n).getTime(),s=new Date(a+r).getTime();return Date.now()<=s}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.matchesSegments=void 0;var n=r(49);e.matchesSegments=function(t,e){var r=e.exclude,i=e.include;if(r)for(var o=0,a=r;o<a.length;o++){var s=a[o];if((0,n.matchesSegment)(t,s))return!1}for(var u=0,c=i;u<c.length;u++){s=c[u];if((0,n.matchesSegment)(t,s))return!0}return!1}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.matchesSegment=void 0;var n=r(50);e.matchesSegment=function(t,e){for(var r=0,i=e.criteria.and;r<i.length;r++){var o=i[r];if(!(0,n.matchesAndCriteria)(t,o))return!1}return!0}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.matchesAndCriteria=void 0;var n=r(51);e.matchesAndCriteria=function(t,e){return e.or.some((function(e){return(0,n.matchesCriterion)(t,e)}))}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.matchesCriterion=void 0;var n=function(t){switch(t){case"channel":return"channels";case"subchannel":return"subChannels";case"geo":return"geo";case"keyword":return"keywords";case"platform":return"platform"}},i=function(t,e){var r=t[n(e.property)];return r?(Array.isArray(r)?r:[r]).some((function(t){return t===e.value})):"ALL"===e.value},o=function(t,e){var r=t[n(e.property)];if(!r)return!1;var i=Array.isArray(r)?r:[r],o=Array.isArray(e.value)?e.value:[e.value];return i.some((function(t){return o.includes(t)}))},a={eq:i,neq:function(t,e){return!i(t,e)},not_one_of:function(t,e){return!o(t,e)},one_of:o};e.matchesCriterion=function(t,e){return(0,a[e.operator])(t,e)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getPullNotificationData=void 0;e.getPullNotificationData=function(t,e,r){var n=e.assetId,i=e.body,o=e.clickThroughUrl,a=e.id,s=e.organisation,u=e.title,c=e.image,l=e.icon,f=e.metadata,p=t.geo,d=t.platform,h=new URL(o);return h.searchParams.has("ito")||h.searchParams.append("ito","pull-notification"),h.searchParams.append("ci","".concat(e.id)),r&&h.searchParams.append("xi","".concat(r)),n&&h.searchParams.append("ai","".concat(n)),{assetId:n,body:i,campaignId:a,clickThroughUrl:h.href,geo:p,icon:l,image:c,metadata:f,organisation:s,platform:d,title:u,type:"pull-notification",userAgent:navigator.userAgent}}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.trackPullNotificationClickLoad=void 0;var a=r(21),s=r(24),u=o(r(7));e.trackPullNotificationClickLoad=function(t,e){return n(void 0,void 0,void 0,(function(){var r,n,o,c,l,f,p,d,h,v;return i(this,(function(i){switch(i.label){case 0:return r=e.crossOrgUserId,n=e.metadata,o=e.emit,c=e.baseEndpoint,l=e.apiKey,f=t.get("ci"),p=t.get("ai"),d=t.get("xi"),f?(h=function(t){var e=t.sharedCrossOrgUserId,r=t.crossOrgUserId,n=t.campaignId;return e?r!==e?a.PullNotificationEventAction.CLICK_PAGE_SHARE:(0,s.wasTrackedBefore)(n,e)?a.PullNotificationEventAction.CLICK_PAGE_REFRESH:a.PullNotificationEventAction.CLICK_PAGE_LOAD:a.PullNotificationEventAction.CLICK_PAGE_LOAD}({campaignId:f,crossOrgUserId:r,sharedCrossOrgUserId:d}),v={action:h,campaignId:f,crossOrgUserId:r,organisation:n.organisation,platform:n.platform,type:"pull-notification",userAgent:navigator.userAgent},p&&(v.assetId=p),[4,(0,u.default)(c,v,l)]):[3,2];case 1:i.sent(),o("pull_notification_click",v),(0,s.markAsTracked)(f,r||"unknown"),i.label=2;case 2:return[2]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.getCrossOrgUserId=void 0;var o=r(55),a=r(10),s=r(4);e.getCrossOrgUserId=function(t,e){return n(void 0,void 0,void 0,(function(){var r,n,u,c;return i(this,(function(i){switch(i.label){case 0:r=(0,s.getStatus)(),n=t.organisation,u=r&&Array.isArray(r.metadata.crossOrgUserIds)?r.metadata.crossOrgUserIds:[],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,(0,o.getCrossOrgUserIdFromCentral)(n)];case 2:return[2,i.sent()||void 0];case 3:return c=i.sent(),(0,a.handleRegisterError)(c,{emit:e,metadata:t}),[3,4];case 4:return[2,u[u.length-1]]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.getCrossOrgUserIdFromCentral=e.API_ROOT_BY_ENV=void 0;var o=r(56);e.API_ROOT_BY_ENV={development:{central:"".concat(location.protocol,"//").concat(location.host,"/public/v1/static/latest/mol-fe-web-push-browser-register")},integration:{central:"https://hulkint.anm.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register"},production:{central:"https://hulkprod.anm.co.uk/api/web-push-notification/v1/static/latest/mol-fe-web-push-browser-register"}};var a={inews:["inews.co.uk"],metro:["metro.co.uk"],mol:["www.dailymail.co.uk","a.dailymail.co.uk","b.dailymail.co.uk","c.dailymail.co.uk"],newzit:["www.newzit.com"]};e.getCrossOrgUserIdFromCentral=function(t){return n(void 0,void 0,void 0,(function(){var r,n,s;return i(this,(function(i){switch(i.label){case 0:return r=function(t,e){var r=new URL(e).hostname;if("localhost"===r||r.endsWith("ngrok.io"))return"development";if(!a[t])throw new Error("No hostnames for organisation: ".concat(t));return a[t].includes(r)?"production":"integration"}(t,location.href),n="".concat(e.API_ROOT_BY_ENV[r].central,"/crossOrgInlinedMin.html?command=getCrossOrgUserId"),[4,(0,o.loadIframeAndWaitForMessage)(n,"mol-fe-web-push-cross-org-user-id")];case 1:return[2,(s=i.sent())&&s.crossOrgUserId]}}))}))}},function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}u((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.loadIframeAndWaitForMessage=void 0;e.loadIframeAndWaitForMessage=function(t,e){return n(void 0,void 0,void 0,(function(){var r;return i(this,(function(n){return r=new URL(t).origin,[2,new Promise((function(n,i){var o,a=null,s=function(t){t.data.scope===e&&t.origin===r&&(window.removeEventListener("message",s),o&&clearTimeout(o),void 0!==t.data.data?n(t.data.data):i(new Error("Invalid data posted back from crossOrg iframe")),a&&a.remove())};window.addEventListener("message",s),(a=document.createElement("iframe")).style.width="0px",a.style.height="0px",a.style.border="none",a.src=t,document.body.appendChild(a),o=window.setTimeout((function(){window.removeEventListener("message",s),i(new Error("crossOrg iframe timed out")),a&&a.remove()}),1e4)}))]}))}))}}])}));
//# sourceMappingURL=register.min.js.map